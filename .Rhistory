plot.subtitle = element_text(          #subtitle
size = 12,
hjust = .5,
face = 'italic',
vjust = 3),               #font size
axis.title = element_text(             #axis titles
size =14),               #font size
axis.text.x = element_text(              #axis text
size = 12),
legend.text = element_text(size = 10),
legend.title = element_text(size = 11, face="bold"),
# t, r, b, l
plot.margin = unit(c(1,.5,.5,.5), "cm"),
legend.position = "right",
strip.text.x = element_text(size = 14, face = "bold", color="white"),
strip.background = element_rect(fill = "#3E3D3D")
) %+replace%
theme(...)
}
# Chunk 2: load data
# load companies file of EIN to name and endowment data
companies_to_ein <- read_rds(here('data',   'companies.RDS'))
companies_to_ein <- companies_to_ein %>%
mutate(organization_name = ifelse(
organization_name == "Ballet Hispanico",
"Ballet Hispánico",
organization_name))
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning = FALSE, comment=NA, eval=FALSE)
library(tidyverse)
library(kableExtra)
library(scales)
library(plotly)
library(glue)
library(here)
library(viridis)
all_plots <- FALSE
m <- list(
l = 50,
r = 50,
b = 200,
t = 150,
pad = 0.5
)
theme_c <- function(...){
# font <- "Helvetica"   #assign font family up front
theme_bw() %+replace%    #replace elements we want to change
theme(
#text elements
plot.title = element_text(             #title
size = 14,                #set font size
face = 'bold',            #bold typeface
hjust = .5,
vjust = 3),
plot.subtitle = element_text(          #subtitle
size = 12,
hjust = .5,
face = 'italic',
vjust = 3),               #font size
axis.title = element_text(             #axis titles
size =14),               #font size
axis.text.x = element_text(              #axis text
size = 12),
legend.text = element_text(size = 10),
legend.title = element_text(size = 11, face="bold"),
# t, r, b, l
plot.margin = unit(c(1,.5,.5,.5), "cm"),
legend.position = "right",
strip.text.x = element_text(size = 14, face = "bold", color="white"),
strip.background = element_rect(fill = "#3E3D3D")
) %+replace%
theme(...)
}
# Chunk 2: load data
# load companies file of EIN to name and endowment data
companies_to_ein <- read_rds(here('data',   'companies.RDS'))
companies_to_ein <- companies_to_ein %>%
mutate(organization_name = ifelse(
organization_name == "Ballet Hispanico",
"Ballet Hispánico",
organization_name))
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning = FALSE, comment=NA, eval=FALSE)
library(tidyverse)
library(kableExtra)
library(scales)
library(plotly)
library(glue)
library(here)
library(viridis)
all_plots <- FALSE
m <- list(
l = 50,
r = 50,
b = 200,
t = 150,
pad = 0.5
)
theme_c <- function(...){
# font <- "Helvetica"   #assign font family up front
theme_bw() %+replace%    #replace elements we want to change
theme(
#text elements
plot.title = element_text(             #title
size = 14,                #set font size
face = 'bold',            #bold typeface
hjust = .5,
vjust = 3),
plot.subtitle = element_text(          #subtitle
size = 12,
hjust = .5,
face = 'italic',
vjust = 3),               #font size
axis.title = element_text(             #axis titles
size =14),               #font size
axis.text.x = element_text(              #axis text
size = 12),
legend.text = element_text(size = 10),
legend.title = element_text(size = 11, face="bold"),
# t, r, b, l
plot.margin = unit(c(1,.5,.5,.5), "cm"),
legend.position = "right",
strip.text.x = element_text(size = 14, face = "bold", color="white"),
strip.background = element_rect(fill = "#3E3D3D")
) %+replace%
theme(...)
}
# Chunk 2: load data
# load companies file of EIN to name and endowment data
companies_to_ein <- read_rds(here('data',   'companies.RDS'))
companies_to_ein <- companies_to_ein %>%
mutate(organization_name = ifelse(
organization_name == "Ballet Hispanico",
"Ballet Hispánico",
organization_name))
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning = FALSE, comment=NA, eval=FALSE)
library(tidyverse)
library(kableExtra)
library(scales)
library(plotly)
library(glue)
library(here)
library(viridis)
all_plots <- FALSE
m <- list(
l = 50,
r = 50,
b = 200,
t = 150,
pad = 0.5
)
theme_c <- function(...){
# font <- "Helvetica"   #assign font family up front
theme_bw() %+replace%    #replace elements we want to change
theme(
#text elements
plot.title = element_text(             #title
size = 14,                #set font size
face = 'bold',            #bold typeface
hjust = .5,
vjust = 3),
plot.subtitle = element_text(          #subtitle
size = 12,
hjust = .5,
face = 'italic',
vjust = 3),               #font size
axis.title = element_text(             #axis titles
size =14),               #font size
axis.text.x = element_text(              #axis text
size = 12),
legend.text = element_text(size = 10),
legend.title = element_text(size = 11, face="bold"),
# t, r, b, l
plot.margin = unit(c(1,.5,.5,.5), "cm"),
legend.position = "right",
strip.text.x = element_text(size = 14, face = "bold", color="white"),
strip.background = element_rect(fill = "#3E3D3D")
) %+replace%
theme(...)
}
companies <- readRDS("~/Desktop/smith-capstone-24/data/companies.RDS")
companies <- readRDS("~/Desktop/smith-capstone-24/data/companies.RDS")
companies_to_ein <- read_rds(here('data',   'companies.RDS'))
companies_to_ein <- companies_to_ein %>%
mutate(organization_name = ifelse(
organization_name == "Ballet Hispanico",
"Ballet Hispánico",
organization_name))
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning = FALSE, comment=NA, eval=FALSE)
library(tidyverse)
library(kableExtra)
library(scales)
library(plotly)
library(glue)
library(here)
library(viridis)
all_plots <- FALSE
m <- list(
l = 50,
r = 50,
b = 200,
t = 150,
pad = 0.5
)
theme_c <- function(...){
# font <- "Helvetica"   #assign font family up front
theme_bw() %+replace%    #replace elements we want to change
theme(
#text elements
plot.title = element_text(             #title
size = 14,                #set font size
face = 'bold',            #bold typeface
hjust = .5,
vjust = 3),
plot.subtitle = element_text(          #subtitle
size = 12,
hjust = .5,
face = 'italic',
vjust = 3),               #font size
axis.title = element_text(             #axis titles
size =14),               #font size
axis.text.x = element_text(              #axis text
size = 12),
legend.text = element_text(size = 10),
legend.title = element_text(size = 11, face="bold"),
# t, r, b, l
plot.margin = unit(c(1,.5,.5,.5), "cm"),
legend.position = "right",
strip.text.x = element_text(size = 14, face = "bold", color="white"),
strip.background = element_rect(fill = "#3E3D3D")
) %+replace%
theme(...)
}
View(companies)
companies_to_ein <- read_rds(here('data',   'companies.RDS'))
endowment_data <- read_rds(here("data",
"endowments_by_most_recent_filings.RDS")) %>%
select(-c(EndowmentsHeldUnrelatedOrgInd, EndowmentsHeldRelatedOrgInd)) %>%
pivot_longer(-c(EIN, fiscal_year),
names_to = "variable_name") %>%
left_join(companies_to_ein) %>%
mutate(fiscal_year=as.numeric(paste(fiscal_year)))
companies_to_ein <- companies_to_ein %>%
mutate(organization_name = ifelse(
organization_name == "Ballet Hispanico",
"Ballet Hispánico",
organization_name))
# extract return dates
source(here("GET_VARS.R"))
files <- dir(here("ballet_990_released_20230208"),
full.names = TRUE)
dates <- map_df(files,
~get_df(filename = .x,
variables = c("//Return//ReturnHeader//TaxPeriodEndDt"))) %>%
mutate(fiscal_year = as.numeric(paste(fiscal_year))) %>%
filter_ein()
dates <- readRDS( here('data', 'dates.RDS')) %>%
select(EIN, TaxPeriodEndDt, fiscal_year)
endowment_data <- endowment_data %>%
mutate(fiscal_year=as.numeric(paste(fiscal_year))) %>%
left_join(dates)
plt <- endowment_data_wide %>%
select(contains("EOY"),fiscal_year,
EIN, organization_name) %>%
pivot_longer(cols = contains("EOY"))  %>%
mutate(name = case_when(
name == "TermEndowmentBalanceEOYPct" ~ "Temporarily restricted endowment",
name == "PrmnntEndowmentBalanceEOYPct" ~ "Permanent endowment",
name == "BoardDesignatedBalanceEOYPct" ~ "Board designated or quasi-endowment"
)) %>%
mutate(value = 100*value) %>%
filter(!is.na(value)) %>%
ggplot(aes(x=fiscal_year,
y  = value,
color = organization_name)) +
geom_line() +
facet_wrap(~name) +
theme_c(strip.text = element_text(margin =margin(3,0,25,0),
size =4,
lineheight=.5)) +
scale_color_viridis(option="rocket", discrete= TRUE) +
labs(y="Percentage of Endowment in Category",
x = "Fiscal Year")
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning = FALSE, comment=NA, eval=FALSE)
library(tidyverse)
library(kableExtra)
library(scales)
library(plotly)
library(glue)
library(here)
library(viridis)
all_plots <- FALSE
m <- list(
l = 50,
r = 50,
b = 200,
t = 150,
pad = 0.5
)
theme_c <- function(...){
# font <- "Helvetica"   #assign font family up front
theme_bw() %+replace%    #replace elements we want to change
theme(
#text elements
plot.title = element_text(             #title
size = 14,                #set font size
face = 'bold',            #bold typeface
hjust = .5,
vjust = 3),
plot.subtitle = element_text(          #subtitle
size = 12,
hjust = .5,
face = 'italic',
vjust = 3),               #font size
axis.title = element_text(             #axis titles
size =14),               #font size
axis.text.x = element_text(              #axis text
size = 12),
legend.text = element_text(size = 10),
legend.title = element_text(size = 11, face="bold"),
# t, r, b, l
plot.margin = unit(c(1,.5,.5,.5), "cm"),
legend.position = "right",
strip.text.x = element_text(size = 14, face = "bold", color="white"),
strip.background = element_rect(fill = "#3E3D3D")
) %+replace%
theme(...)
}
# Chunk 2: load data
# load companies file of EIN to name and endowment data
companies_to_ein <- read_rds(here('data',   'companies.RDS'))
companies_to_ein <- companies_to_ein %>%
mutate(organization_name = ifelse(
organization_name == "Ballet Hispanico",
"Ballet Hispánico",
organization_name))
companies <- readRDS("~/Desktop/smith-capstone-24/data/companies.RDS")
View(companies)
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning = FALSE, comment=NA, eval=FALSE)
library(tidyverse)
library(kableExtra)
library(scales)
library(plotly)
library(glue)
library(here)
library(viridis)
all_plots <- FALSE
m <- list(
l = 50,
r = 50,
b = 200,
t = 150,
pad = 0.5
)
theme_c <- function(...){
# font <- "Helvetica"   #assign font family up front
theme_bw() %+replace%    #replace elements we want to change
theme(
#text elements
plot.title = element_text(             #title
size = 14,                #set font size
face = 'bold',            #bold typeface
hjust = .5,
vjust = 3),
plot.subtitle = element_text(          #subtitle
size = 12,
hjust = .5,
face = 'italic',
vjust = 3),               #font size
axis.title = element_text(             #axis titles
size =14),               #font size
axis.text.x = element_text(              #axis text
size = 12),
legend.text = element_text(size = 10),
legend.title = element_text(size = 11, face="bold"),
# t, r, b, l
plot.margin = unit(c(1,.5,.5,.5), "cm"),
legend.position = "right",
strip.text.x = element_text(size = 14, face = "bold", color="white"),
strip.background = element_rect(fill = "#3E3D3D")
) %+replace%
theme(...)
}
# load companies file of EIN to name and endowment data
companies_to_ein <- read_rds(here('data',   'companies.RDS'))
companies_to_ein <- companies_to_ein %>%
rename(organization_name = Company) %>%
mutate(organization_name = ifelse(
organization_name == "Ballet Hispanico",
"Ballet Hispánico",
organization_name))
endowment_data <- read_rds(here("data",
"endowments_by_most_recent_filings.RDS")) %>%
select(-c(EndowmentsHeldUnrelatedOrgInd, EndowmentsHeldRelatedOrgInd)) %>%
pivot_longer(-c(EIN, fiscal_year),
names_to = "variable_name") %>%
left_join(companies_to_ein) %>%
mutate(fiscal_year=as.numeric(paste(fiscal_year)))
companies_to_ein <- read_rds(here('data',   'companies.RDS'))
companies_to_ein <- companies_to_ein %>%
rename(organization_name = Company) %>%
mutate(organization_name = ifelse(
organization_name == "Ballet Hispanico",
"Ballet Hispánico",
organization_name))
endowment_data <- read_rds(here("data",
"endowments_by_most_recent_filings.RDS")) %>%
select(-c(EndowmentsHeldUnrelatedOrgInd, EndowmentsHeldRelatedOrgInd)) %>%
pivot_longer(-c(EIN, fiscal_year),
names_to = "variable_name") %>%
left_join(companies_to_ein) %>%
mutate(fiscal_year=as.numeric(paste(fiscal_year)))
endowment_data <- read_rds(here("data",
"endowments_by_most_recent_filings.RDS")) %>%
select(-c(EndowmentsHeldUnrelatedOrgInd, EndowmentsHeldRelatedOrgInd)) %>%
mutate(BeginningYearBalanceAmt = as.numeric(as.character(BeginningYearBalanceAmt)),
ContributionsAmt = as.numeric(as.character(ContributionsAmt)),
OtherExpendituresAmt = as.numeric(as.character(OtherExpendituresAmt)),
AdministrativeExpensesAmt = as.numeric(as.character(AdministrativeExpensesAmt)),
GrantsOrScholarshipsAmt = as.numeric(as.character(GrantsOrScholarshipsAmt)),
InvestmentEarningsOrLossesAmt = as.numeric(as.character(InvestmentEarningsOrLossesAmt)),
EndYearBalanceAmt = as.numeric(as.character(EndYearBalanceAmt)),
EndingBalanceAmt = as.numeric(as.character(EndingBalanceAmt))
) %>%
pivot_longer(-c(EIN, fiscal_year),
names_to = "variable_name") %>%
left_join(companies_to_ein) %>%
mutate(fiscal_year=as.numeric(paste(fiscal_year)))
# Chunk 1: setup
knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning = FALSE, comment=NA, eval=FALSE)
library(tidyverse)
library(kableExtra)
library(scales)
library(plotly)
library(glue)
library(here)
library(viridis)
all_plots <- FALSE
m <- list(
l = 50,
r = 50,
b = 200,
t = 150,
pad = 0.5
)
theme_c <- function(...){
# font <- "Helvetica"   #assign font family up front
theme_bw() %+replace%    #replace elements we want to change
theme(
#text elements
plot.title = element_text(             #title
size = 14,                #set font size
face = 'bold',            #bold typeface
hjust = .5,
vjust = 3),
plot.subtitle = element_text(          #subtitle
size = 12,
hjust = .5,
face = 'italic',
vjust = 3),               #font size
axis.title = element_text(             #axis titles
size =14),               #font size
axis.text.x = element_text(              #axis text
size = 12),
legend.text = element_text(size = 10),
legend.title = element_text(size = 11, face="bold"),
# t, r, b, l
plot.margin = unit(c(1,.5,.5,.5), "cm"),
legend.position = "right",
strip.text.x = element_text(size = 14, face = "bold", color="white"),
strip.background = element_rect(fill = "#3E3D3D")
) %+replace%
theme(...)
}
# Chunk 2: load data
# load companies file of EIN to name and endowment data
companies_to_ein <- read_rds(here('data',   'companies.RDS'))
companies_to_ein <- companies_to_ein %>%
rename(organization_name = Company) %>%
mutate(organization_name = ifelse(
organization_name == "Ballet Hispanico",
"Ballet Hispánico",
organization_name))
endowment_data <- read_rds(here("data",
"endowments_by_most_recent_filings.RDS")) %>%
select(-c(EndowmentsHeldUnrelatedOrgInd, EndowmentsHeldRelatedOrgInd)) %>%
mutate(BeginningYearBalanceAmt = as.numeric(as.character(BeginningYearBalanceAmt)),
ContributionsAmt = as.numeric(as.character(ContributionsAmt)),
OtherExpendituresAmt = as.numeric(as.character(OtherExpendituresAmt)),
AdministrativeExpensesAmt = as.numeric(as.character(AdministrativeExpensesAmt)),
GrantsOrScholarshipsAmt = as.numeric(as.character(GrantsOrScholarshipsAmt)),
InvestmentEarningsOrLossesAmt = as.numeric(as.character(InvestmentEarningsOrLossesAmt)),
EndYearBalanceAmt = as.numeric(as.character(EndYearBalanceAmt)),
EndingBalanceAmt = as.numeric(as.character(EndingBalanceAmt))
) %>%
pivot_longer(-c(EIN, fiscal_year),
names_to = "variable_name") %>%
left_join(companies_to_ein) %>%
mutate(fiscal_year=as.numeric(paste(fiscal_year)))
# extract return dates
source(here("GET_VARS.R"))
files <- dir(here("ballet_990_released_20230208"),
full.names = TRUE)
dates <- map_df(files,
~get_df(filename = .x,
variables = c("//Return//ReturnHeader//TaxPeriodEndDt"))) %>%
mutate(fiscal_year = as.numeric(paste(fiscal_year))) %>%
filter_ein()
